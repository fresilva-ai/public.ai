<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp RRHH - Ver√≥nica | MetroCapital AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: linear-gradient(180deg, #00a884 0%, #00a884 127px, #d9dbd5 127px, #d9dbd5 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .phone-container {
            width: 100%;
            max-width: 420px;
            height: 90vh;
            max-height: 800px;
            background: #fff;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: #075e54;
            color: white;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }

        .back-arrow {
            cursor: pointer;
            font-size: 24px;
        }

        .profile-pic {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            font-weight: bold;
        }

        .chat-info {
            flex: 1;
        }

        .chat-name {
            font-size: 16px;
            font-weight: 500;
        }

        .chat-status {
            font-size: 13px;
            opacity: 0.8;
        }

        .chat-container {
            flex: 1;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAATElEQVQYV2NkIBIwEqmOAa+CP39+M/z//5+BkZGRgYGBgQGnQpCCf3//Mvz7958BphoXBimCKQapwqkQpghkKkgVTgUwRTBVOBXiVAcAW5oYDqAJ5ZAAAAAASUVORK5CYII=');
            background-size: 400px;
            overflow-y: auto;
            padding: 20px 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            max-width: 75%;
            padding: 8px 12px;
            border-radius: 7px;
            position: relative;
            word-wrap: break-word;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-received {
            background: #fff;
            align-self: flex-start;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }

        .message-sent {
            background: #dcf8c6;
            align-self: flex-end;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }

        .message-time {
            font-size: 11px;
            color: #667781;
            margin-top: 4px;
            text-align: right;
        }

        .quick-replies {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .quick-reply-btn {
            background: #075e54;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .quick-reply-btn:hover {
            background: #128c7e;
            transform: scale(1.05);
        }

        .input-container {
            background: #f0f0f0;
            padding: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            border-top: 1px solid #e0e0e0;
        }

        .emoji-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #54656f;
        }

        .message-input {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 25px;
            background: white;
            font-size: 15px;
            outline: none;
        }

        .send-btn {
            background: #075e54;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.3s;
        }

        .send-btn:hover {
            background: #128c7e;
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            padding: 10px 15px;
            background: #fff;
            border-radius: 7px;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }

        .typing-indicator.show {
            display: block;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667781;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.5;
                transform: scale(1);
            }
            30% {
                opacity: 1;
                transform: scale(1.2);
            }
        }

        .welcome-menu {
            background: #e8f5ff;
            padding: 12px;
            border-radius: 7px;
            margin-bottom: 10px;
        }

        .menu-title {
            font-weight: bold;
            color: #075e54;
            margin-bottom: 8px;
        }

        .menu-option {
            display: flex;
            align-items: center;
            margin: 6px 0;
            cursor: pointer;
            color: #303030;
        }

        .menu-option:hover {
            color: #075e54;
        }

        .menu-icon {
            margin-right: 8px;
            font-size: 18px;
        }

        @media (max-width: 480px) {
            .phone-container {
                height: 100vh;
                max-height: 100vh;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="chat-header">
            <span class="back-arrow">‚Üê</span>
            <div class="profile-pic">VA</div>
            <div class="chat-info">
                <div class="chat-name">Ver√≥nica - RRHH MetroCapital AI</div>
                <div class="chat-status">En l√≠nea</div>
            </div>
        </div>

        <div class="chat-container" id="chatContainer">
            <!-- Los mensajes aparecer√°n aqu√≠ -->
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>

        <div class="input-container">
            <button class="emoji-btn">üòä</button>
            <input 
                type="text" 
                class="message-input" 
                id="messageInput" 
                placeholder="Escribe un mensaje..."
            >
            <button class="send-btn" id="sendBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                    <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // Sistema de IA conversacional
        const aiSystem = {
            contextMemory: [],
            userProfile: {
                name: null,
                department: null,
                previousQueries: []
            },
            
            // Analizador de sentimiento e intenci√≥n
            analyzeIntent: function(message) {
                const lower = message.toLowerCase();
                
                // Detectar saludos
                if (/^(hola|hi|hey|buenas|buenos d√≠as|buenas tardes|qu√© tal)/i.test(lower)) {
                    return 'greeting';
                }
                
                // Detectar despedidas
                if (/\b(adi√≥s|adios|chau|bye|hasta luego|gracias|muchas gracias)\b/i.test(lower)) {
                    return 'farewell';
                }
                
                // Detectar frustraci√≥n o problemas
                if (/\b(problema|ayuda|urgente|no funciona|error|mal|molesto|frustrado)\b/i.test(lower)) {
                    return 'issue';
                }
                
                // Detectar preguntas complejas
                if (/\b(c√≥mo|como|cu√°ndo|cuando|por qu√©|porque|explicar|entender|diferencia)\b/i.test(lower)) {
                    return 'complex_question';
                }
                
                // Detectar solicitudes de comparaci√≥n
                if (/\b(mejor|peor|versus|comparar|diferencia entre|o |elegir)\b/i.test(lower)) {
                    return 'comparison';
                }
                
                return 'general';
            },
            
            // Generar respuestas contextuales
            generateContextualResponse: function(message, intent) {
                const responses = {
                    greeting: [
                        "¬°Hola! üòä Soy Ver√≥nica de RRHH. ¬øEn qu√© puedo ayudarte hoy con los beneficios de MetroCapital AI?",
                        "¬°Buenos d√≠as! Soy Ver√≥nica, tu asistente de RRHH. Estoy aqu√≠ para resolver todas tus dudas. ¬øQu√© necesitas saber?",
                        "¬°Hola! Qu√© gusto saludarte. Soy Ver√≥nica y estoy para ayudarte con cualquier tema de RRHH en MetroCapital AI. ¬øEn qu√© te puedo asistir?"
                    ],
                    farewell: [
                        "¬°Que tengas un excelente d√≠a! Recuerda que estoy disponible 24/7. ¬°Hasta pronto! - Ver√≥nica üòä",
                        "¬°Hasta luego! Si necesitas algo m√°s, no dudes en escribirme. Siempre estar√© aqu√≠ para ayudarte. - Ver√≥nica",
                        "¬°Gracias por contactarme! Espero haber sido de ayuda. ¬°Que tengas un gran d√≠a! - Ver√≥nica üåü"
                    ],
                    issue: [
                        "Entiendo tu preocupaci√≥n. Soy Ver√≥nica y voy a asegurarme de que resolvamos esto juntos. ¬øPuedes darme m√°s detalles sobre el problema?",
                        "Lamento que est√©s experimentando dificultades. Como tu asistente de RRHH, quiero ayudarte. Cu√©ntame m√°s para poder asistirte mejor.",
                        "Veo que necesitas ayuda urgente. Soy Ver√≥nica y estoy aqu√≠ para apoyarte. ¬øCu√°l es espec√≠ficamente el problema que est√°s enfrentando?"
                    ],
                    complex_question: this.generateComplexAnswer(message),
                    comparison: this.generateComparisonAnswer(message),
                    general: this.generateGeneralAnswer(message)
                };
                
                if (Array.isArray(responses[intent])) {
                    return responses[intent][Math.floor(Math.random() * responses[intent].length)];
                }
                return responses[intent];
            },
            
            // Respuestas para preguntas complejas
            generateComplexAnswer: function(message) {
                const lower = message.toLowerCase();
                
                if (lower.includes('c√≥mo') && lower.includes('solicitar')) {
                    return `üìã *Proceso de Solicitud:*

Para solicitar cualquier beneficio, sigue estos pasos:

1. **Ingresa al Portal RRHH** con tu RUT y contrase√±a
2. **Selecciona "Mis Beneficios"** en el men√∫ principal
3. **Elige el beneficio** que deseas solicitar
4. **Completa el formulario** con la informaci√≥n requerida
5. **Adjunta documentos** si son necesarios
6. **Env√≠a la solicitud** y recibir√°s confirmaci√≥n por email

‚è±Ô∏è Tiempo de respuesta: 2-5 d√≠as h√°biles

¬øHay alg√∫n beneficio espec√≠fico que quieras solicitar?`;
                }
                
                if (lower.includes('por qu√©') || lower.includes('porque')) {
                    return `Esa es una excelente pregunta. Las pol√≠ticas de beneficios de MetroCapital AI est√°n dise√±adas para:

‚Ä¢ **Atraer y retener talento:** Como empresa l√≠der en IA, ofrecemos beneficios competitivos en el sector tecnol√≥gico
‚Ä¢ **Promover el bienestar integral:** Cubrimos salud f√≠sica, mental y financiera de nuestros colaboradores
‚Ä¢ **Apoyar el desarrollo:** Invertimos en el crecimiento profesional continuo, especialmente en tecnolog√≠as de IA
‚Ä¢ **Balance vida-trabajo:** Facilitamos la flexibilidad y el tiempo personal para mantener equipos creativos y productivos
‚Ä¢ **Cultura de innovaci√≥n:** Nuestros beneficios reflejan nuestros valores de innovaci√≥n y cuidado del talento

¬øTe gustar√≠a conocer m√°s detalles sobre alguna pol√≠tica espec√≠fica de MetroCapital AI?`;
                }
                
                if (lower.includes('cu√°ndo') || lower.includes('cuando')) {
                    return `üìÖ *Tiempos y Plazos Importantes:*

Los tiempos var√≠an seg√∫n el tipo de solicitud:

‚Ä¢ **Beneficios de salud:** Activaci√≥n inmediata tras aprobaci√≥n
‚Ä¢ **Reembolsos:** 5-10 d√≠as h√°biles
‚Ä¢ **Vacaciones:** Solicitar con 15 d√≠as de anticipaci√≥n
‚Ä¢ **Capacitaciones:** Aprobaci√≥n en 3 d√≠as h√°biles
‚Ä¢ **Bonos:** Se pagan junto con la liquidaci√≥n mensual

¬øSobre qu√© beneficio espec√≠fico necesitas saber los tiempos?`;
                }
                
                return this.generateGeneralAnswer(message);
            },
            
            // Generar comparaciones
            generateComparisonAnswer: function(message) {
                const lower = message.toLowerCase();
                
                if (lower.includes('isapre') && lower.includes('fonasa')) {
                    return `üè• *Comparaci√≥n Isapre vs Fonasa con beneficios MetroCapital AI:*

**Con ISAPRE:**
‚Ä¢ Seguro complementario cubre 80% del copago
‚Ä¢ Libre elecci√≥n de cl√≠nicas y m√©dicos
‚Ä¢ Atenci√≥n m√°s r√°pida
‚Ä¢ Tope anual: UF 100

**Con FONASA:**
‚Ä¢ Seguro complementario cubre 90% (por menor costo base)
‚Ä¢ Red de prestadores en convenio
‚Ä¢ Sin topes de edad
‚Ä¢ Tope anual: UF 120

üí° *Recomendaci√≥n de Ver√≥nica:* En MetroCapital AI, ambas opciones tienen excelente cobertura con nuestro seguro complementario. La elecci√≥n depende de tus preferencias personales y situaci√≥n familiar.`;
                }
                
                if (lower.includes('presencial') && lower.includes('remoto')) {
                    return `üè¢üè† *Modalidad Presencial vs Remota en MetroCapital AI:*

**Trabajo Presencial:**
‚Ä¢ Colaboraci√≥n directa con equipos de IA
‚Ä¢ Acceso a laboratorios y salas de innovaci√≥n
‚Ä¢ Networking con expertos en tecnolog√≠a
‚Ä¢ Alimentaci√≥n en casino gourmet

**Trabajo Remoto:**
‚Ä¢ Mayor flexibilidad para proyectos de IA
‚Ä¢ Ahorro en transporte
‚Ä¢ Bono internet $30.000
‚Ä¢ Bono alimentaci√≥n $150.000
‚Ä¢ Setup ergon√≥mico completo

**H√≠brido (recomendado por MetroCapital AI):**
‚Ä¢ 3 d√≠as oficina + 2 d√≠as casa
‚Ä¢ Ideal para roles en desarrollo de IA
‚Ä¢ Flexibilidad seg√∫n sprints y proyectos

Como empresa de tecnolog√≠a e IA, valoramos mucho la flexibilidad. ¬øQu√© modalidad te interesa m√°s?`;
                }
                
                return "Puedo ayudarte a comparar diferentes opciones. ¬øQu√© espec√≠ficamente te gustar√≠a comparar?";
            },
            
            // Respuestas generales con IA
            generateGeneralAnswer: function(message) {
                const lower = message.toLowerCase();
                
                // Respuestas sobre el equipo de RRHH
                if (lower.includes('contacto') || lower.includes('hablar') || lower.includes('rrhh')) {
                    return `üìû *Contacto Directo con RRHH - MetroCapital AI:*

**Canales disponibles:**
‚Ä¢ üìß Email: rrhh@metrocapital.ai
‚Ä¢ üì± WhatsApp RRHH: +56 9 1234 5678
‚Ä¢ ‚òéÔ∏è Anexo: 2000
‚Ä¢ üè¢ Oficina: Piso 3, Torre A
‚Ä¢ üë§ Ver√≥nica (yo): Disponible 24/7 por este chat

**Horario de atenci√≥n presencial:**
Lunes a Viernes: 9:00 - 18:00

Para temas urgentes fuera de horario, escr√≠beme aqu√≠ o usa el WhatsApp y te responderemos a primera hora del siguiente d√≠a h√°bil.

¬øPrefieres que yo, Ver√≥nica, te ayude directamente con tu consulta?`;
                }
                
                // Informaci√≥n sobre plazos y procesos
                if (lower.includes('cu√°nto') && (lower.includes('demora') || lower.includes('tarda'))) {
                    return `‚è±Ô∏è Los tiempos de procesamiento dependen del tipo de solicitud. En general:

‚Ä¢ Consultas simples: Respuesta inmediata aqu√≠
‚Ä¢ Solicitudes est√°ndar: 2-3 d√≠as h√°biles
‚Ä¢ Reembolsos: 5-10 d√≠as h√°biles
‚Ä¢ Cambios de beneficios: 1 mes (para el siguiente per√≠odo)

¬øQu√© proceso espec√≠fico necesitas realizar?`;
                }
                
                // Elegibilidad y requisitos
                if (lower.includes('requisito') || lower.includes('puedo') || lower.includes('elegible')) {
                    return `‚úÖ *Elegibilidad General para Beneficios:*

**Colaboradores con contrato indefinido:**
‚Ä¢ Acceso completo desde el d√≠a 1
‚Ä¢ Todos los beneficios disponibles

**Colaboradores a plazo fijo:**
‚Ä¢ Beneficios b√°sicos inmediatos
‚Ä¢ Beneficios completos despu√©s de 6 meses

**Practicantes:**
‚Ä¢ Alimentaci√≥n y transporte
‚Ä¢ Acceso a capacitaciones

¬øCu√°l es tu tipo de contrato para darte informaci√≥n m√°s espec√≠fica?`;
                }
                
                // Respuesta por defecto mejorada
                return `Entiendo tu consulta sobre "${message}". Aunque no tengo informaci√≥n espec√≠fica pre-programada sobre esto, te sugiero:

1. **Consultar el Manual de Beneficios** completo en el portal RRHH
2. **Contactar directamente a RRHH** para una respuesta personalizada
3. **Revisar las categor√≠as principales** del men√∫

Tambi√©n puedo ayudarte con temas como:
‚Ä¢ Beneficios de salud, alimentaci√≥n y bienestar
‚Ä¢ Pol√≠ticas de vacaciones y trabajo remoto
‚Ä¢ Convenios y descuentos
‚Ä¢ Procesos y requisitos

¬øHay algo m√°s espec√≠fico en lo que pueda asistirte?`;
            },
            
            // Memoria contextual
            rememberContext: function(message, response) {
                this.contextMemory.push({
                    timestamp: new Date(),
                    userMessage: message,
                    botResponse: response
                });
                
                // Mantener solo los √∫ltimos 10 intercambios
                if (this.contextMemory.length > 10) {
                    this.contextMemory.shift();
                }
            },
            
            // Detectar y recordar informaci√≥n del usuario
            extractUserInfo: function(message) {
                // Detectar nombre
                const nameMatch = message.match(/soy\s+(\w+)|me llamo\s+(\w+)/i);
                if (nameMatch) {
                    this.userProfile.name = nameMatch[1] || nameMatch[2];
                }
                
                // Detectar departamento
                const deptMatch = message.match(/trabajo en\s+(\w+)|departamento de\s+(\w+)/i);
                if (deptMatch) {
                    this.userProfile.department = deptMatch[1] || deptMatch[2];
                }
            },
            
            // Personalizar respuestas basadas en contexto
            personalizeResponse: function(response) {
                if (this.userProfile.name) {
                    response = response.replace(/¬°Hola!/g, `¬°Hola ${this.userProfile.name}!`);
                    // Ocasionalmente agregar el nombre en las respuestas
                    if (Math.random() > 0.6 && !response.includes(this.userProfile.name)) {
                        response = response.replace('¬ø', `${this.userProfile.name}, ¬ø`);
                    }
                }
                
                if (this.contextMemory.length > 3) {
                    // Si ya hemos tenido varias interacciones
                    const randomPhrases = [
                        "\n\nüí° Como hemos estado conversando, recuerda que tambi√©n puedes...",
                        "\n\nüìå Bas√°ndome en tus consultas anteriores, tal vez te interese...",
                        "\n\nüîç Si necesitas m√°s detalles sobre lo que hemos hablado, no dudes en preguntarme.",
                        "\n\n‚ú® Por cierto, seg√∫n lo que me has consultado, podr√≠a serte √∫til saber que..."
                    ];
                    
                    if (Math.random() > 0.7) {
                        response += randomPhrases[Math.floor(Math.random() * randomPhrases.length)];
                    }
                }
                
                // Agregar firma de Ver√≥nica ocasionalmente en respuestas largas
                if (response.length > 500 && Math.random() > 0.5) {
                    response += "\n\n- Ver√≥nica, RRHH MetroCapital AI üíú";
                }
                
                return response;
            }
        };

        // Base de conocimiento del bot
        const knowledgeBase = {
            beneficios: {
                salud: {
                    keywords: ['seguro', 'salud', 'm√©dico', 'medico', 'isapre', 'fonasa', 'dental', 'oftalmol√≥gico'],
                    response: `üè• *Beneficios de Salud:*

‚Ä¢ *Seguro Complementario:* Cobertura del 80% en gastos m√©dicos ambulatorios y hospitalarios
‚Ä¢ *Seguro Dental:* Plan completo con copago desde $5.000
‚Ä¢ *Seguro de Vida:* 24 sueldos para beneficiarios
‚Ä¢ *Telemedicina:* Consultas online gratuitas 24/7
‚Ä¢ *Convenio √ìpticas:* 40% descuento en lentes y marcos

üìã *C√≥mo usar:* Ingresa a la plataforma de beneficios con tu RUT`,
                    quickReplies: ['Ver convenios m√©dicos', 'Reembolsos', 'Volver al men√∫']
                },
                alimentacion: {
                    keywords: ['alimentaci√≥n', 'alimentacion', 'almuerzo', 'comida', 'sodexo', 'ticket', 'casino'],
                    response: `üçΩÔ∏è *Beneficios de Alimentaci√≥n:*

‚Ä¢ *Ticket Restaurant:* $8.000 diarios (d√≠as h√°biles)
‚Ä¢ *Casino empresa:* Subvencionado al 70%
‚Ä¢ *Colaci√≥n remota:* $150.000 mensuales para teletrabajo
‚Ä¢ *Snacks saludables:* Disponibles en todas las oficinas

üí≥ *Tarjeta Sodexo:* Se carga autom√°ticamente el d√≠a 25 de cada mes`,
                    quickReplies: ['Saldo Sodexo', 'Convenios restaurantes', 'Men√∫ principal']
                },
                vacaciones: {
                    keywords: ['vacaciones', 'descanso', 'feriado', 'd√≠as libres', 'dias libres', 'permiso'],
                    response: `üèñÔ∏è *Pol√≠tica de Vacaciones:*

‚Ä¢ *D√≠as base:* 15 d√≠as h√°biles anuales
‚Ä¢ *D√≠as progresivos:* +1 d√≠a por cada 3 a√±os de antig√ºedad
‚Ä¢ *D√≠as administrativos:* 5 d√≠as al a√±o
‚Ä¢ *Cumplea√±os:* Medio d√≠a libre
‚Ä¢ *Vacaciones adelantadas:* Hasta 5 d√≠as

üìÖ *Solicitudes:* A trav√©s del portal RRHH con 15 d√≠as de anticipaci√≥n`,
                    quickReplies: ['Solicitar vacaciones', 'Ver saldo de d√≠as', 'Calendario feriados']
                },
                formacion: {
                    keywords: ['capacitaci√≥n', 'capacitacion', 'curso', 'formaci√≥n', 'formacion', 'estudio', 'certificaci√≥n', 'beca'],
                    response: `üìö *Desarrollo Profesional:*

‚Ä¢ *Presupuesto anual:* USD $1.500 por colaborador
‚Ä¢ *Plataformas online:* Acceso a Coursera, Udemy Business, LinkedIn Learning
‚Ä¢ *Ingl√©s:* Clases grupales e individuales
‚Ä¢ *Certificaciones:* 100% financiadas (previa aprobaci√≥n)
‚Ä¢ *Postgrados:* Hasta 50% de financiamiento

üéì *D√≠a de capacitaci√≥n:* 8 horas mensuales en horario laboral`,
                    quickReplies: ['Ver cursos disponibles', 'Solicitar capacitaci√≥n', 'Men√∫ principal']
                },
                bienestar: {
                    keywords: ['gimnasio', 'deporte', 'bienestar', 'wellness', 'mental', 'psic√≥logo', 'psicologo'],
                    response: `üí™ *Programa de Bienestar:*

‚Ä¢ *Gimnasio:* Convenio SmartFit - Plan Black sin costo
‚Ä¢ *Apoyo psicol√≥gico:* 12 sesiones anuales gratuitas
‚Ä¢ *Pausas activas:* Sesiones diarias de 15 minutos
‚Ä¢ *Masajes:* 2 sesiones mensuales en oficina
‚Ä¢ *Clases online:* Yoga, mindfulness, pilates

üßò *App Bienestar:* Descarga "TechCorp Wellness" para agendar`,
                    quickReplies: ['Agendar masaje', 'Horarios gimnasio', 'Contactar psic√≥logo']
                },
                familia: {
                    keywords: ['hijo', 'hijos', 'familia', 'maternal', 'paternal', 'guarder√≠a', 'guarderia', 'nacimiento'],
                    response: `üë®‚Äçüë©‚Äçüëß‚Äçüë¶ *Beneficios Familiares:*

‚Ä¢ *Sala cuna:* $200.000 mensuales hasta los 2 a√±os
‚Ä¢ *Jard√≠n infantil:* $150.000 hasta los 5 a√±os  
‚Ä¢ *Bono escolaridad:* $300.000 en marzo (por hijo)
‚Ä¢ *Bono nacimiento:* $500.000
‚Ä¢ *Permiso postnatal extendido:* +2 semanas con goce de sueldo
‚Ä¢ *Seguro escolar:* Accidentes 24/7

üéí *√ötiles escolares:* Kit completo para cada hijo en edad escolar`,
                    quickReplies: ['Requisitos bono escolar', 'Convenios colegios', 'Volver']
                },
                trabajo_remoto: {
                    keywords: ['remoto', 'teletrabajo', 'casa', 'home office', 'h√≠brido', 'hibrido', 'flexibilidad'],
                    response: `üè† *Trabajo Remoto y Flexibilidad:*

‚Ä¢ *Modalidad h√≠brida:* 3 d√≠as oficina, 2 d√≠as remoto
‚Ä¢ *Full remoto:* Disponible para cargos espec√≠ficos
‚Ä¢ *Horario flexible:* Entrada entre 8:00 y 10:00 AM
‚Ä¢ *Viernes corto:* Salida a las 14:00
‚Ä¢ *Internet hogar:* Bono de $30.000 mensuales
‚Ä¢ *Setup ergon√≥mico:* $400.000 √∫nicos para equipamiento

üíª *Equipos:* Notebook, monitor, teclado y mouse corporativos`,
                    quickReplies: ['Solicitar d√≠a remoto', 'Bono internet', 'Equipamiento']
                }
            },
            convenios: {
                keywords: ['convenio', 'descuento', 'alianza', 'promoci√≥n', 'promocion'],
                response: `ü§ù *Principales Convenios:*

üè™ *Retail:*
‚Ä¢ Falabella: 15% dcto. + 6 cuotas sin inter√©s
‚Ä¢ Paris: 20% dcto. en vestuario
‚Ä¢ Ripley: 15% dcto. general

üöó *Automotriz:*
‚Ä¢ Derco: Precios preferenciales
‚Ä¢ Europcar: 35% arriendo autos

üè´ *Educaci√≥n:*
‚Ä¢ Universidades: Hasta 25% dcto
‚Ä¢ Institutos idiomas: 30% dcto

¬øQu√© convenio te interesa conocer en detalle?`,
                quickReplies: ['Lista completa', 'C√≥mo acceder', 'Men√∫ principal']
            },
            preguntas_frecuentes: {
                liquidacion: {
                    keywords: ['liquidaci√≥n', 'liquidacion', 'sueldo', 'pago', 'remuneraci√≥n', 'remuneracion'],
                    response: `üí∞ *Sobre tu Liquidaci√≥n:*

‚Ä¢ *Fecha de pago:* √öltimo d√≠a h√°bil del mes
‚Ä¢ *Modalidad:* Transferencia bancaria
‚Ä¢ *Liquidaci√≥n digital:* Disponible el d√≠a 28 en el portal
‚Ä¢ *Anticipo:* D√≠a 15 (hasta 40% del sueldo l√≠quido)

üìß Consultas: liquidaciones@techcorp.com`,
                    quickReplies: ['Descargar liquidaci√≥n', 'Solicitar anticipo', 'Volver']
                },
                licencias: {
                    keywords: ['licencia', 'm√©dica', 'medica', 'enfermo', 'reposo'],
                    response: `üè• *Proceso de Licencias M√©dicas:*

1. Informar a jefatura directa (primer d√≠a)
2. Subir licencia al portal RRHH (m√°x 48 hrs)
3. RRHH tramita con Isapre/Fonasa
4. Seguimiento en portal del colaborador

‚ö†Ô∏è *Importante:* Licencias de 1-3 d√≠as se pagan al 100%`,
                    quickReplies: ['Subir licencia', 'Estado licencia', 'Men√∫']
                },
                evaluacion: {
                    keywords: ['evaluaci√≥n', 'evaluacion', 'desempe√±o', 'desempeno', 'feedback', 'review'],
                    response: `üìä *Proceso de Evaluaci√≥n:*

‚Ä¢ *Frecuencia:* Semestral (junio y diciembre)
‚Ä¢ *Metodolog√≠a:* 360¬∞ + autoevaluaci√≥n
‚Ä¢ *Bonos:* Seg√∫n resultado (0-30% del sueldo)
‚Ä¢ *Calibraci√≥n:* Por √°rea y nivel
‚Ä¢ *Feedback:* Reuni√≥n 1:1 obligatoria

üìà Pr√≥xima evaluaci√≥n: Diciembre 2024`,
                    quickReplies: ['Mi √∫ltima evaluaci√≥n', 'Criterios', 'Volver']
                }
            }
        };

        // Variables globales
        let chatContainer = document.getElementById('chatContainer');
        let messageInput = document.getElementById('messageInput');
        let sendBtn = document.getElementById('sendBtn');
        let typingIndicator = document.getElementById('typingIndicator');

        // Funci√≥n para obtener la hora actual
        function getCurrentTime() {
            const now = new Date();
            return now.getHours().toString().padStart(2, '0') + ':' + 
                   now.getMinutes().toString().padStart(2, '0');
        }

        // Funci√≥n para agregar mensaje al chat
        function addMessage(text, type, quickReplies = []) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            
            // Procesar formato de texto (negritas con *)
            const formattedText = text.replace(/\*(.*?)\*/g, '<strong>$1</strong>');
            
            messageDiv.innerHTML = `
                ${formattedText}
                <div class="message-time">${getCurrentTime()}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            
            // Agregar respuestas r√°pidas si existen
            if (quickReplies.length > 0 && type === 'received') {
                const quickReplyDiv = document.createElement('div');
                quickReplyDiv.className = 'quick-replies message message-received';
                quickReplyDiv.style.maxWidth = '90%';
                
                quickReplies.forEach(reply => {
                    const btn = document.createElement('button');
                    btn.className = 'quick-reply-btn';
                    btn.textContent = reply;
                    btn.onclick = () => handleQuickReply(reply);
                    quickReplyDiv.appendChild(btn);
                });
                
                chatContainer.appendChild(quickReplyDiv);
            }
            
            // Scroll al final
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Funci√≥n para manejar respuestas r√°pidas
        function handleQuickReply(text) {
            addMessage(text, 'sent');
            setTimeout(() => processMessage(text), 500);
        }

        // Funci√≥n para procesar mensajes del usuario
        function processMessage(message) {
            const lowerMessage = message.toLowerCase();
            
            // Extraer informaci√≥n del usuario si la proporciona
            aiSystem.extractUserInfo(message);
            
            // Mostrar indicador de escritura
            typingIndicator.classList.add('show');
            chatContainer.appendChild(typingIndicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Analizar la intenci√≥n del mensaje
            const intent = aiSystem.analyzeIntent(message);
            
            setTimeout(() => {
                typingIndicator.classList.remove('show');
                
                let responded = false;
                let response = '';
                let quickReplies = [];
                
                // Primero, verificar si es una conversaci√≥n general (saludos, despedidas, etc.)
                if (intent === 'greeting' || intent === 'farewell') {
                    response = aiSystem.generateContextualResponse(message, intent);
                    if (intent === 'greeting') {
                        quickReplies = ['Ver beneficios', 'Tengo una pregunta', 'Men√∫ principal'];
                    }
                    responded = true;
                }
                
                // Comandos especiales
                if (lowerMessage.includes('men√∫') || lowerMessage.includes('menu') || 
                    lowerMessage.includes('inicio') || lowerMessage.includes('volver')) {
                    showMainMenu();
                    return;
                }
                
                // Si no es saludo/despedida, buscar en base de conocimiento
                if (!responded) {
                    // Buscar coincidencias exactas en la base de conocimiento
                    for (let category in knowledgeBase) {
                        if (category === 'beneficios') {
                            for (let benefit in knowledgeBase.beneficios) {
                                const benefitData = knowledgeBase.beneficios[benefit];
                                for (let keyword of benefitData.keywords) {
                                    if (lowerMessage.includes(keyword)) {
                                        response = benefitData.response;
                                        quickReplies = benefitData.quickReplies;
                                        responded = true;
                                        break;
                                    }
                                }
                                if (responded) break;
                            }
                        } else if (category === 'convenios') {
                            for (let keyword of knowledgeBase.convenios.keywords) {
                                if (lowerMessage.includes(keyword)) {
                                    response = knowledgeBase.convenios.response;
                                    quickReplies = knowledgeBase.convenios.quickReplies;
                                    responded = true;
                                    break;
                                }
                            }
                        } else if (category === 'preguntas_frecuentes') {
                            for (let faq in knowledgeBase.preguntas_frecuentes) {
                                const faqData = knowledgeBase.preguntas_frecuentes[faq];
                                for (let keyword of faqData.keywords) {
                                    if (lowerMessage.includes(keyword)) {
                                        response = faqData.response;
                                        quickReplies = faqData.quickReplies;
                                        responded = true;
                                        break;
                                    }
                                }
                                if (responded) break;
                            }
                        }
                        if (responded) break;
                    }
                }
                
                // Si no hay coincidencia exacta, usar IA para generar respuesta
                if (!responded) {
                    // Verificar si es una pregunta compleja o comparaci√≥n
                    if (intent === 'complex_question' || intent === 'comparison' || intent === 'issue') {
                        response = aiSystem.generateContextualResponse(message, intent);
                        quickReplies = ['M√°s informaci√≥n', 'Hablar con RRHH', 'Men√∫ principal'];
                    } else {
                        // Intentar generar una respuesta general con IA
                        response = aiSystem.generateGeneralAnswer(message);
                        quickReplies = ['Ver beneficios', 'Contactar RRHH', 'Men√∫ principal'];
                    }
                }
                
                // Personalizar la respuesta bas√°ndose en el contexto
                response = aiSystem.personalizeResponse(response);
                
                // Guardar en memoria contextual
                aiSystem.rememberContext(message, response);
                
                // Agregar an√°lisis de seguimiento si hay contexto previo
                if (aiSystem.contextMemory.length > 2 && Math.random() > 0.6) {
                    setTimeout(() => {
                        const followUpMessages = [
                            "¬øHay algo m√°s espec√≠fico sobre este tema que quieras saber?",
                            "¬øTe gustar√≠a que profundice en alg√∫n punto?",
                            "¬øNecesitas informaci√≥n adicional?",
                            "¬øEsto responde tu pregunta o necesitas m√°s detalles?"
                        ];
                        addMessage(followUpMessages[Math.floor(Math.random() * followUpMessages.length)], 'received', 
                            ['S√≠, m√°s detalles', 'No, est√° claro', 'Otra pregunta']);
                    }, 2000);
                }
                
                // Mostrar la respuesta
                addMessage(response, 'received', quickReplies);
                
                // Agregar sugerencias proactivas ocasionalmente
                if (Math.random() > 0.8 && aiSystem.userProfile.previousQueries.length < 5) {
                    setTimeout(() => {
                        const suggestions = [
                            "üí° *Tip de Ver√≥nica:* ¬øSab√≠as que en MetroCapital AI puedes acumular d√≠as de vacaciones no utilizados hasta por 2 per√≠odos?",
                            "üì¢ *Recordatorio:* El per√≠odo de evaluaci√≥n de desempe√±o comienza el pr√≥ximo mes. ¬°Prep√°rate para destacar!",
                            "üéØ *¬øLo sab√≠as?* Puedes usar tu presupuesto de capacitaci√≥n para certificaciones en IA y Machine Learning.",
                            "‚ú® *Novedad en MetroCapital AI:* Acabamos de agregar convenios con nuevos restaurantes tech-friendly en tu zona.",
                            "üöÄ *Beneficio exclusivo:* Como parte de MetroCapital AI, tienes acceso gratuito a conferencias internacionales de IA.",
                            "üß† *Desarrollo profesional:* Tenemos un programa de mentor√≠a con expertos en IA. ¬øTe interesa participar?",
                            "üíú *Cultura MetroCapital:* Nuestros viernes de innovaci√≥n te permiten trabajar en proyectos personales de IA."
                        ];
                        addMessage(suggestions[Math.floor(Math.random() * suggestions.length)], 'received');
                    }, 4000);
                }
                
                // Guardar la consulta del usuario
                if (!aiSystem.userProfile.previousQueries.includes(lowerMessage)) {
                    aiSystem.userProfile.previousQueries.push(lowerMessage);
                }
            }, 1500);
        }

        // Funci√≥n para mostrar el men√∫ principal
        function showMainMenu() {
            const menuHTML = `
                <div class="welcome-menu">
                    <div class="menu-title">¬øEn qu√© te puedo ayudar hoy?</div>
                    <div class="menu-option" onclick="handleQuickReply('Beneficios de salud')">
                        <span class="menu-icon">üè•</span> Beneficios de Salud
                    </div>
                    <div class="menu-option" onclick="handleQuickReply('Beneficios de alimentaci√≥n')">
                        <span class="menu-icon">üçΩÔ∏è</span> Alimentaci√≥n
                    </div>
                    <div class="menu-option" onclick="handleQuickReply('Vacaciones y permisos')">
                        <span class="menu-icon">üèñÔ∏è</span> Vacaciones
                    </div>
                    <div class="menu-option" onclick="handleQuickReply('Capacitaci√≥n')">
                        <span class="menu-icon">üìö</span> Formaci√≥n y Desarrollo
                    </div>
                    <div class="menu-option" onclick="handleQuickReply('Bienestar')">
                        <span class="menu-icon">üí™</span> Bienestar y Wellness
                    </div>
                    <div class="menu-option" onclick="handleQuickReply('Beneficios familiares')">
                        <span class="menu-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span> Familia
                    </div>
                    <div class="menu-option" onclick="handleQuickReply('Trabajo remoto')">
                        <span class="menu-icon">üè†</span> Trabajo Remoto
                    </div>
                    <div class="menu-option" onclick="handleQuickReply('Ver convenios')">
                        <span class="menu-icon">ü§ù</span> Convenios y Descuentos
                    </div>
                    <div class="menu-option" onclick="handleQuickReply('Preguntas frecuentes')">
                        <span class="menu-icon">‚ùì</span> Preguntas Frecuentes
                    </div>
                </div>
            `;
            
            const menuDiv = document.createElement('div');
            menuDiv.className = 'message message-received';
            menuDiv.style.maxWidth = '90%';
            menuDiv.innerHTML = menuHTML + `<div class="message-time">${getCurrentTime()}</div>`;
            chatContainer.appendChild(menuDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Funci√≥n para enviar mensaje
        function sendMessage() {
            const message = messageInput.value.trim();
            if (message) {
                addMessage(message, 'sent');
                messageInput.value = '';
                
                // Procesar mensaje despu√©s de un peque√±o delay
                setTimeout(() => processMessage(message), 500);
            }
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Mensaje inicial de bienvenida
        window.addEventListener('load', () => {
            setTimeout(() => {
                addMessage('¬°Hola! üëã Soy Ver√≥nica, tu asistente de RRHH en MetroCapital AI.', 'received');
                setTimeout(() => {
                    addMessage('Estoy aqu√≠ para ayudarte con todos los temas de beneficios, convenios y cualquier consulta que tengas sobre la empresa. ¬°Preg√∫ntame lo que necesites!', 'received');
                    setTimeout(() => {
                        addMessage('üí¨ Puedes escribirme de forma natural. Entiendo preguntas complejas y puedo mantener una conversaci√≥n fluida contigo.', 'received');
                        setTimeout(() => {
                            showMainMenu();
                        }, 1500);
                    }, 1500);
                }, 1500);
            }, 500);
        });

        // Simular que el bot est√° "en l√≠nea"
        setInterval(() => {
            const status = document.querySelector('.chat-status');
            if (status.textContent === 'En l√≠nea') {
                status.textContent = 'Escribiendo...';
                setTimeout(() => {
                    status.textContent = 'En l√≠nea';
                }, 2000);
            }
        }, 30000);
    </script>
</body>
</html>